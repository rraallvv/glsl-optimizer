#include <metal_stdlib>
using namespace metal;
struct xlatMtlShaderInput {
  float2 xlv_TEXCOORD0;
};
struct xlatMtlShaderOutput {
  half4 _glesFragData_0 [[color(0)]];
  half4 _glesFragData_1 [[color(1)]];
};
struct xlatMtlShaderUniform {
  float4 _ZBufferParams;
  float4 _LightPos;
  float4x4 _FrustumRays;
  float4 _CameraPosLocal;
  float4 _CoordTexDim;
  float4 _ScreenTexDim;
};
fragment xlatMtlShaderOutput xlatMtlMain (xlatMtlShaderInput _mtl_i [[stage_in]], constant xlatMtlShaderUniform& _mtl_u [[buffer(0)]]
  ,   texture2d<half> _CameraDepthTexture [[texture(0)]], sampler _mtlsmp__CameraDepthTexture [[sampler(0)]])
{
  xlatMtlShaderOutput _mtl_o;
  float4 depth_1;
  float tmpvar_2;
  tmpvar_2 = clamp ((_mtl_i.xlv_TEXCOORD0.y - (0.5 / _mtl_u._CoordTexDim.y)), 0.0, 1.0);
  int tmpvar_3;
  tmpvar_3 = int(clamp (floor(
    (tmpvar_2 * 4.0)
  ), 0.0, 3.0));
  float tmpvar_4;
  tmpvar_4 = (-1.0 + (2.0 * fract(
    (tmpvar_2 * 4.0)
  )));
  float4 tmpvar_5;
  tmpvar_5.xz = float2(-1.0, 1.0);
  tmpvar_5.y = tmpvar_4;
  tmpvar_5.w = -(tmpvar_4);
  float4 tmpvar_6;
  tmpvar_6.yw = float2(-1.0, 1.0);
  tmpvar_6.x = -(tmpvar_4);
  tmpvar_6.z = tmpvar_4;
  bool4 tmpvar_7;
  tmpvar_7 = bool4((int4(tmpvar_3) == int4(0, 1, 2, 3)));
  half4 tmpvar_8;
  tmpvar_8 = half4(tmpvar_7);
  half4 tmpvar_9;
  tmpvar_9 = half4(tmpvar_7);
  float2 tmpvar_10;
  tmpvar_10.x = dot (tmpvar_6, (float4)tmpvar_8);
  tmpvar_10.y = dot (tmpvar_5, (float4)tmpvar_9);
  float2 tmpvar_11;
  tmpvar_11 = ((mix (_mtl_u._LightPos.xy, 
    -(tmpvar_10)
  , float2(
    clamp (((_mtl_i.xlv_TEXCOORD0.x - (0.5 / _mtl_u._CoordTexDim.x)) * (_mtl_u._CoordTexDim.x / (_mtl_u._CoordTexDim.x - 1.0))), 0.0, 1.0)
  )) * 0.5) + 0.5);
  float4 tmpvar_12;
  tmpvar_12.zw = float2(0.0, 0.0);
  tmpvar_12.xy = tmpvar_11;
  float2 tmpvar_13;
  tmpvar_13 = ((floor(
    (tmpvar_11 * _mtl_u._ScreenTexDim.xy)
  ) + 0.5) * _mtl_u._ScreenTexDim.zw);
  half4 tmpvar_14;
  tmpvar_14 = _CameraDepthTexture.sample(_mtlsmp__CameraDepthTexture, (float2)(tmpvar_13));
  float tmpvar_15;
  float z_16;
  z_16 = float(tmpvar_14.x);
  tmpvar_15 = (1.0/(((_mtl_u._ZBufferParams.x * z_16) + _mtl_u._ZBufferParams.y)));
  depth_1 = float4(tmpvar_15);
  float4 v_17;
  v_17.x = _mtl_u._FrustumRays[0].x;
  v_17.y = _mtl_u._FrustumRays[1].x;
  v_17.z = _mtl_u._FrustumRays[2].x;
  v_17.w = _mtl_u._FrustumRays[3].x;
  float4 v_18;
  v_18.x = _mtl_u._FrustumRays[0].y;
  v_18.y = _mtl_u._FrustumRays[1].y;
  v_18.z = _mtl_u._FrustumRays[2].y;
  v_18.w = _mtl_u._FrustumRays[3].y;
  float4 v_19;
  v_19.x = _mtl_u._FrustumRays[0].w;
  v_19.y = _mtl_u._FrustumRays[1].w;
  v_19.z = _mtl_u._FrustumRays[2].w;
  v_19.w = _mtl_u._FrustumRays[3].w;
  float4 v_20;
  v_20.x = _mtl_u._FrustumRays[0].z;
  v_20.y = _mtl_u._FrustumRays[1].z;
  v_20.z = _mtl_u._FrustumRays[2].z;
  v_20.w = _mtl_u._FrustumRays[3].z;
  float3 tmpvar_21;
  tmpvar_21 = mix (mix (v_17.xyz, v_18.xyz, tmpvar_11.xxx), mix (v_19.xyz, v_20.xyz, tmpvar_11.xxx), tmpvar_11.yyy);
  float tmpvar_22;
  tmpvar_22 = sqrt(dot (tmpvar_21, tmpvar_21));
  bool tmpvar_23;
  float3 tmpvar_24;
  tmpvar_24 = (1.0/((tmpvar_21 / tmpvar_22)));
  float3 tmpvar_25;
  tmpvar_25 = (tmpvar_24 * (-0.5 - _mtl_u._CameraPosLocal.xyz));
  float3 tmpvar_26;
  tmpvar_26 = (tmpvar_24 * (0.5 - _mtl_u._CameraPosLocal.xyz));
  float3 tmpvar_27;
  tmpvar_27 = min (tmpvar_26, tmpvar_25);
  float3 tmpvar_28;
  tmpvar_28 = max (tmpvar_26, tmpvar_25);
  float2 tmpvar_29;
  tmpvar_29 = max (tmpvar_27.xx, tmpvar_27.yz);
  float tmpvar_30;
  tmpvar_30 = max (tmpvar_29.x, tmpvar_29.y);
  float2 tmpvar_31;
  tmpvar_31 = min (tmpvar_28.xx, tmpvar_28.yz);
  float tmpvar_32;
  tmpvar_32 = min (tmpvar_31.x, tmpvar_31.y);
  tmpvar_23 = bool(((tmpvar_30 < tmpvar_32) && (tmpvar_32 > 0.0)));
  if (((bool)!(tmpvar_23) || (tmpvar_15 < (tmpvar_30 / tmpvar_22)))) {
    depth_1 = -(float4(tmpvar_15));
  } else {
    depth_1 = min (depth_1, float4((tmpvar_32 / tmpvar_22)));
  };
  _mtl_o._glesFragData_0 = half4(tmpvar_12);
  _mtl_o._glesFragData_1 = half4(depth_1);
  return _mtl_o;
}


// stats: 65 alu 1 tex 1 flow
// inputs: 1
//  #0: xlv_TEXCOORD0 (high float) 2x1 [-1]
// uniforms: 6 (total size: 144)
//  #0: _ZBufferParams (high float) 4x1 [-1] loc 0
//  #1: _LightPos (high float) 4x1 [-1] loc 16
//  #2: _FrustumRays (high float) 4x4 [-1] loc 32
//  #3: _CameraPosLocal (high float) 4x1 [-1] loc 96
//  #4: _CoordTexDim (high float) 4x1 [-1] loc 112
//  #5: _ScreenTexDim (high float) 4x1 [-1] loc 128
// textures: 1
//  #0: _CameraDepthTexture (low 2d) 0x0 [-1] loc 0
