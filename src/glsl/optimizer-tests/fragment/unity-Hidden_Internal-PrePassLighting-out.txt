uniform vec4 unity_LightmapFade;
uniform vec4 _ZBufferParams;
uniform mat4 _ViewToCookie;
uniform mat4 _View2Shadow;
uniform samplerCube _ShadowMapTexture;
uniform vec4 _ProjectionParams;
uniform sampler2D _LightTextureB0;
uniform samplerCube _LightTexture0;
uniform vec4 _LightShadowData;
uniform vec4 _LightPositionRange;
uniform vec4 _LightPos;
uniform vec4 _LightColor;
uniform sampler2D _CameraNormalsTexture;
uniform sampler2D _CameraDepthTexture;
float ComputeShadow (
  in vec3 vec,
  in vec2 uv
)
{
  mat3 tmpvar_32;
  tmpvar_32[0] = _View2Shadow[0].xyz;
  tmpvar_32[1] = _View2Shadow[1].xyz;
  tmpvar_32[2] = _View2Shadow[2].xyz;
  vec3 tmpvar_5;
  tmpvar_5 = (tmpvar_32 * vec);
  vec = tmpvar_5;
  float tmpvar_8;
  tmpvar_8 = ((length (tmpvar_5) * _LightPositionRange.w) * 0.97);
  float tmpvar_43;
  tmpvar_43 = dot (textureCube (_ShadowMapTexture, tmpvar_5), vec4(1.0, 0.00392157, 1.53787e-005, 0.0));
  float tmpvar_45;
  if ((tmpvar_43 < tmpvar_8)) {
    tmpvar_45 = _LightShadowData.x;
  } else {
    tmpvar_45 = 1.0;
  };
  return tmpvar_45;
  return 1.0;
}

void main ()
{
  vec4 tmpvar_2;
  tmpvar_2 = gl_TexCoord[0].xyzw;
  vec3 tmpvar_4;
  tmpvar_4 = gl_TexCoord[1].xyz;
  vec4 res;
  float atten;
  vec3 lightDir;
  vec3 vpos;
  vec3 normal;
  vec4 nspec;
  vec2 tmpvar_50;
  tmpvar_50 = (tmpvar_2.xy / tmpvar_2.w);
  vec4 tmpvar_51;
  tmpvar_51 = texture2D (_CameraNormalsTexture, tmpvar_50);
  nspec = tmpvar_51;
  normal = normalize (((tmpvar_51.xyz * 2.0) - 1.0));
  vec3 tmpvar_61;
  tmpvar_61 = ((tmpvar_4 * (_ProjectionParams.z / tmpvar_4.z)) * 1.0/(((_ZBufferParams.x * texture2D (_CameraDepthTexture, tmpvar_50).x) + _ZBufferParams.y)));
  vpos = tmpvar_61;
  vec3 tmpvar_62;
  tmpvar_62 = (_LightPos.xyz - tmpvar_61);
  lightDir = normalize (tmpvar_62);
  atten = texture2D (_LightTextureB0, vec2((dot (tmpvar_62, tmpvar_62) * _LightPos.w))).w;
  float tmpvar_71;
  tmpvar_71 = ComputeShadow (-(tmpvar_62), tmpvar_50);
  vec4 tmpvar_73;
  tmpvar_73.xyz = vpos.xyz;
  tmpvar_73.w = 1.0;
  float tmpvar_75;
  tmpvar_75 = ((atten * tmpvar_71) * textureCube (_LightTexture0, (_ViewToCookie * tmpvar_73).xyz).w);
  atten = tmpvar_75;
  res.xyz = (_LightColor.xyz * (max (0.0, dot (lightDir, normal)) * tmpvar_75)).xyz;
  res.w = (vec4(((pow (max (0.0, dot (normalize ((lightDir - normalize (vpos))), normal)), (nspec.w * 128.0)) * clamp (tmpvar_75, 0.0, 1.0)) * dot (_LightColor.xyz, vec3(0.22, 0.707, 0.071))))).w;
  vec4 tmpvar_99;
  tmpvar_99 = (res * clamp ((1.0 - ((vpos.z * unity_LightmapFade.z) + unity_LightmapFade.w)), 0.0, 1.0));
  res = tmpvar_99;
  gl_FragData[0] = exp2 (-(tmpvar_99)).xyzw;
}

